## 源码分析笔记

一致性：
- 强一致性：加分布式锁保证数据一致
- 弱一致性：也就是不需要一致
- 最终一致性：允许先读到一个数据之后再读到另一个。也就是可以等待一段时间才一致


ACP
- Consistency：一致性
- Availability：可用性
- Partition Tolerance：分区容错性

> zk保证了CA


zk解决一致性的机制：
1. 领导这选举
2. 过半机制
3. 预提交、收到ack，提交（两阶段提交）


#### 领导选举
投票箱：数组

选票：当前投给了谁

数据越新、“能力越强”，改票
- 事务性请求：增加、删除、修改
- 非事务性请求：查询

发生的场景：
- 集群启动
- leader挂掉了
- follower挂掉后leader发现已经没有过半的follower跟随自己了，这时会发生领导选举（目的是为了不对外提供服务）


